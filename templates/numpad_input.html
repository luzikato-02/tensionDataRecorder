<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  #container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  #number-form {
    margin: 20px 0;
  }

  .number-button {
    width: 50px;
    height: 50px;
    margin: 5px;
    font-size: 18px;
  }

  .submit-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
    width: 100%;
    margin-top: 10px;
  }

  .submit-button {
    font-size: 18px;
    padding: 12px 0;
  }

  #recorded-numbers {
    margin-top: 20px;
  }

  .arrow-button {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
  }

  #current-id {
    font-size: 24px;
    margin: 0 10px;
  }

  .delete-button {
    background-color: #FF0000;
    color: white;
    border: none;
  }
</style>
<title>Tension Data Recorder</title>
</head>
<body>
<div id="container">
  <h1>Tension Data Recorder</h1>
  
  <div>
    <button class="arrow-button" onclick="prevID()">&#9664;</button>
    <span id="current-id">1</span>
    <button class="arrow-button" onclick="nextID()">&#9654;</button>
  </div>
  
  <form id="number-form">
    <label for="number">Enter Number: </label>
    <input type="number" id="number" name="number" required>
  </form>
  
  <div>
    <button class="number-button" onclick="appendNumber(1)">1</button>
    <button class="number-button" onclick="appendNumber(2)">2</button>
    <button class="number-button" onclick="appendNumber(3)">3</button>
  </div>
  <div>
    <button class="number-button" onclick="appendNumber(4)">4</button>
    <button class="number-button" onclick="appendNumber(5)">5</button>
    <button class="number-button" onclick="appendNumber(6)">6</button>
  </div>
  <div>
    <button class="number-button" onclick="appendNumber(7)">7</button>
    <button class="number-button" onclick="appendNumber(8)">8</button>
    <button class="number-button" onclick="appendNumber(9)">9</button>
  </div>
  <div>
    <button class="number-button" onclick="clearNumber()">C</button>
    <button class="number-button" onclick="appendNumber(0)">0</button>
    <button class="number-button" onclick="backspaceNumber()">&#9003;</button>
  </div>
  
  <div class="submit-buttons">
    <button class="submit-button" onclick="recordNumber()">Submit</button>
    <button class="submit-button" onclick="promptFinish()">Finish</button>
    <button class="custom-button delete-button" onclick="deleteData()">Delete</button>
  </div>


  <div id="recorded-numbers">
    <h2>Recorded Numbers for Spd No. <span id="displayed-id">1</span>:</h2>
    <ul id="numbers-list"></ul>
  </div>
</div>

<script>
  let currentID = 1;
  let data = {};

  function updateIDDisplay() {
    const currentIDElement = document.getElementById('current-id');
    currentIDElement.textContent = currentID;
    document.getElementById('displayed-id').textContent = currentID;
    displayRecordedNumbers();
  }

  function prevID() {
    if (currentID > 1) {
      currentID--;
      updateIDDisplay();
    }
  }

  function nextID() {
    if (currentID < 84) {
      currentID++;
      updateIDDisplay();
    }
  }

  function appendNumber(num) {
    const numberInput = document.getElementById('number');
    numberInput.value += num;
  }

  function backspaceNumber() {
    const numberInput = document.getElementById('number');
    numberInput.value = numberInput.value.slice(0, -1);
  }

  function clearNumber() {
    const numberInput = document.getElementById('number');
    numberInput.value = '';
  }

  function recordNumber() {
    const numberInput = document.getElementById('number');
    const number = numberInput.value;
    data[currentID] = [number];
    console.log(data);
    numberInput.value = '';
    displayRecordedNumbers();
  }

  function promptFinish() {
    const machineNumber = prompt("Enter machine number:");
    const operator = prompt("Enter operator:");
    
    if (machineNumber !== null && operator !== null) {
      const confirmation = confirm("Are you sure you want to finish? This will erase the stored data.");
      if (confirmation) {
        finishRecording(machineNumber, operator);
      }
    }
  }

  function finishRecording(machineNumber, operator) {
    let csvContent = "data:text/csv;charset=utf-8,Machine Number,Operator,DateTime,ID,Numbers\n";
    const now = new Date().toLocaleString();
    
    Object.keys(data).forEach(key => {
      const row = [machineNumber, operator, now, key, data[key].join(",")];
      csvContent += row.join(",") + "\n";
    });
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "recorded_data.csv");
    document.body.appendChild(link);
    link.click();

    data = {};

    displayRecordedNumbers();
  }

  function deleteData() {
    delete data[currentID];
    displayRecordedNumbers();
  }

  function displayRecordedNumbers() {
    const numbersList = document.getElementById('numbers-list');
    numbersList.innerHTML = '';

    if (data[currentID]) {
      data[currentID].forEach(number => {
        const listItem = document.createElement('li');
        listItem.textContent = number;
        numbersList.appendChild(listItem);
      });
    }
  }
</script>
</body>
</html>
